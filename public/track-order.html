<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨</title>
  <style>
    body {
      font-family: Arial;
      padding: 30px;
      max-width: 600px;
      margin: auto;
      direction: rtl;
      background-color: #f9f9f9;
    }
    input {
      padding: 10px;
      width: 100%;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .btn {
      background: #007bff;
      color: white;
      padding: 10px 15px;
      border: none;
      cursor: pointer;
      border-radius: 5px;
    }
    .item {
      margin-bottom: 10px;
      background: #fff;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    .total {
      margin-top: 20px;
      font-weight: bold;
      background: #e1ffe1;
      padding: 10px;
      border-radius: 5px;
    }
    .box {
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <h1>ğŸ” ØªØªØ¨Ø¹ Ø·Ù„Ø¨Ùƒ</h1>
  <input type="number" id="orderIdInput" placeholder="Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨..." />
  <button class="btn" onclick="searchOrder()">Ø¨Ø­Ø«</button>

  <div id="orderResult" class="box"></div>

  <script>
    const formatDateTime = (isoString) => {
      const date = new Date(isoString);
      const datePart = date.toLocaleDateString("ar-EG", {
        day: "2-digit",
        month: "long",
        year: "numeric"
      });
      const timePart = date.toLocaleTimeString("ar-EG", {
        hour: "2-digit",
        minute: "2-digit",
        hour12: true
      });
      return `ğŸ“… ${datePart} â° ${timePart}`;
    };

    async function searchOrder() {
      const orderId = document.getElementById("orderIdInput").value.trim();
      const resultBox = document.getElementById("orderResult");

      if (!orderId) {
        alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨");
        return;
      }

      resultBox.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ...";

      try {
        const res = await fetch(`http://localhost:1337/api/orders?filters[orderId][$eq]=${orderId}&populate=*`);
        const data = await res.json();

        if (!data.data || data.data.length === 0) {
          resultBox.innerHTML = "<p>âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨.</p>";
          return;
        }

        const order = data.data[0];
        const items = order.items || [];

        let html = `
        
          <p><strong>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</strong> ${order.orderId}</p>
          <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${formatDateTime(order.date)}</p>
          ${order.discount ? `<p><strong>Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ…:</strong> ${order.discount * 100}%</p>` : ""}
          <hr style="margin: 10px 0;" />
        `;

        let total = 0;
        items.forEach(item => {
          const price = item.price * item.quantity;
        total += price;
        html += `<div class="item">${item.name} - ${item.price} Ã— ${item.quantity} = ${price} Ø¬Ù†ÙŠÙ‡</div>`;
        html += `<p><strong>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${order.customerName || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"}</p>`;
        html += `<p><strong>Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†:</strong> ${order.customerPhone || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"}</p>`;
        });

        html += `<div class="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…: ${order.total.toFixed(2)} Ø¬Ù†ÙŠÙ‡</div>`;
        resultBox.innerHTML = html;

      } catch (error) {
        console.error("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
        resultBox.innerHTML = "<p>âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ù‹Ø§.</p>";
      }
    }
  </script>
</body>
</html>
